---
import { getCollection } from "astro:content";
import MainLayout from "../../../layouts/MainLayout.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../../consts";
import { sortByDate } from "../../../lib/sortByDate";
import FormattedDate from "../../../components/FormattedDate.astro";
import type { GetStaticPathsOptions, Page } from "astro";
import Card from "../../../components/Card.astro";

export async function getStaticPaths(options: GetStaticPathsOptions) {
  const { paginate } = options;
  const posts = sortByDate(await getCollection("blog"));
  return paginate(posts, { pageSize: 5 });
}

interface Props {
  page: Page;
}

const { page } = Astro.props;
const { data, url, start, end, total, size, currentPage, lastPage } = page;
const { prev, next, current } = url;
---

<MainLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <main class="blog-main">
    <section>
      <ul>
        {
          data.map((post) => {
            return <Card {post} />;
          })
        }
      </ul>
    </section>

    <div class="flex flex-col items-center my-12">
      <div class="flex text-gray-700">
        {
          !!prev && (
            <a
              href={`/astro-blog/blog/page/${currentPage - 1}/`}
              class="h-12 w-12 mr-1 flex justify-center items-center rounded-full"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="100%"
                height="100%"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="feather feather-chevron-left w-6 h-6"
              >
                <polyline points="15 18 9 12 15 6" />
              </svg>
            </a>
          )
        }
        {
          [...Array(lastPage).keys()].map((e: number) => {
            return (
              <a
                href={`/astro-blog/blog/page/${e + 1}/`}
                class={`h-12 w-12 flex justify-center items-center cursor-pointer leading-5 transition duration-150 ease-in rounded-full ${
                  currentPage === e + 1
                    ? "bg-teal-600 text-white"
                    : "text-default"
                }`}
              >
                {e + 1}
              </a>
            );
          })
        }
        {
          !!next && (
            <a
              href={`/astro-blog/blog/page/${currentPage + 1}/`}
              class="h-12 w-12 ml-1 flex justify-center items-center rounded-full cursor-pointer"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="100%"
                height="100%"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="feather feather-chevron-right w-6 h-6"
              >
                <polyline points="9 18 15 12 9 6" />
              </svg>
            </a>
          )
        }
      </div>
    </div>
  </main>
</MainLayout>

<!-- <style>
  .blog-main {
    height: calc(100vh - 324px);
  }
</style> -->
